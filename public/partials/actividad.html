
<div class="row">
	<div ng-class="{'col-lg-3': !oculto, 'col-md-4': !oculto, 'col-sm-4': !oculto, 'hidden': oculto}" class="left animated">
		<organismos otitle="'Organismos con procedimientos'" arbol="arbol" tipoelementos="'procedimiento/s'" attr="'numprocedimientos'" setseleccionado="goToJerarquia" seleccionado="seleccionado"></organismos>
	</div>
	<div ng-class="{'col-lg-9': !oculto, 'col-md-8': !oculto, 'col-sm-8': !oculto, 'col-lg-12': oculto}" class="right animated" id="detallesjerarquia">
		<div>
			<div class="pull-left" ng-click="oculto=!oculto" style="cursor:ew-resize; margin-right:1em" ng-show="seleccionado" title="Pulse para maximizar/restaurar esta vista">
				<div class="btn btn-default">
					<i class="fa fa-bars"></i>
				</div>
			</div>
			<h3>{{seleccionado.title}}</h3>
		</div>
		<div ng-if="procedimientos.length" class="panel panel-danger" style="clear:both">
			<div ng-click="filtrosocultos=!filtrosocultos" class="panel-heading" style="cursor:ns-resize">
				<span ng-class="{&quot;glyphicon-collapse-down&quot;:!filtrosocultos,&quot;glyphicon-expand&quot;:filtrosocultos}" class="glyphicon pull-right">
				</span>
				<div class="progress">
					<div role="progressbar" aria-valuenow="{{100*cumplimentados / count}}" aria-valuemin="0" aria-valuemax="100" style="width:{{100*cumplimentados / count}}%" class="progress-bar progress-bar-striped progress-bar-danger">
						{{(100 * cumplimentados / count)|number : 2 }}% ({{cumplimentados}} / {{count}})
					</div>
				</div>
			</div>
			<div ng-class="{'hidden': filtrosocultos}" class="panel-body">
				<form class="form-horizontal">
					<div ng-repeat="key in camposfiltros" class="form-groupcol-sm-12">
						<label class="control-label col-md-3">
							{{key| translate}}:
						</label>
						<div class="col-md-9">
							<select ng-model="filtro[key]" ng-options="fa.value as fa.name for (ky,fa) in filtros[key]" class="form-control">
							</select>
						</div>
					</div>
					<div class="form-groupcol-sm-12">
						<label class="control-label col-md-3">Filtro:</label>
						<div class="col-md-9">
							<input ng-model="filtrotxtprocedimiento.$" class="form-control"/>
						</div>
					</div>

					<div class="form-group col-sm-12 hidden"  ng-repeat="(familia,etiquetas) in etiquetasPorTipo track by $index" >
						<label class="control-label col-sm-3">{{familia}}:</label>
						<div class="col-sm-9">
							<div ng-repeat="etiqueta in etiquetas track by $index" class="col-sm-6">
								<label class="control-label col-sm-3">
									<input type="checkbox" name="" id="et{{$index}}" value="{{etiqueta._id}}" />
								</label>
								<div class="col-sm-9">
									<label for="et{{$index}}"><span class="label label-danger" title="{{etiqueta.descripcion}}" >{{etiqueta._id}}</span></label>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div>
			{{filtrotxtprocedimiento.codigo}}
		</div>
        <div>
            <div class="btn-group">
                <button ng-class="{disabled: actualizando > 0}" class="btn btn-default" ng-click="descargarExcel()">
                    <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>&nbsp;Descargar excel
                </button>&nbsp;&nbsp;
				<a class="btn btn-default" role="button" href="/resumenorganica/{{idjerarquia}}" ng-if="idjerarquia && !seleccionado">Ver resumen</a>
				<a class="btn btn-default" role="button" href="/resumenorganica/{{seleccionado.id}}" ng-if="seleccionado && seleccionado.id">Ver resumen</a>
                <p ng-if="actualizando > 0">Generando informe...</p>
            </div>
            <div class="alert {{respuesta.clase}}" role="alert">{{respuesta.mensaje}}</div>
        </div>
		<div ng-if="procedimientosfiltrados.length" class="table-responsive">
			<table class="table table-striped table-bordered table-condensed table-hover" id="procedimientostable">
				<thead>
					<tr>
						<th>Progreso</th>
						<th ng-class="{danger:orderby=='codigo' }" ng-click="reverse=!reverse;orderby='codigo'">{{'codigo'|translate}}</th>
						<th ng-class="{danger:orderby=='denominacion' }" ng-click="reverse=!reverse;orderby='denominacion'">{{'denominacion'|translate}}</th>
						<th ng-class="{danger:orderby=='cod_plaza' }" ng-click="reverse=!reverse;orderby='cod_plaza'">{{'cod_plaza'|translate}}</th>
						<th ng-class="{danger:orderby=='ancestro' }" ng-click="reverse=!reverse;orderby='ancestro'">{{'A cargo de'|translate}}</th>
						<th ng-class="{danger:orderby=='periodos[anualidad].totalsolicitudes' }" ng-click="reverse=!reverse;orderby='periodos[anualidad].totalsolicitudes'">Solicitudes {{anualidad.substring(1,5)}}</th>
						<th ng-class="{danger:orderby=='periodos[anualidad].solicitados[mesanterior]' }" ng-click="reverse=!reverse;orderby='periodos[anualidad].solicitados[mesanterior]'">Solicitudes {{meses[mesanterior]}}</th>
					</tr>
				</thead>
				<tfoot>
					<tr>
						<td colspan="7">
							<strong>NÂº de procedimientos listados:</strong>
							{{procedimientosfiltrados.length}}
							<span ng-click="$root.exportXLS('procedimientostable','procedimientos')" class="pull-right glyphicon glyphicon-floppy-disk"></span>
						</td>
					</tr>
				</tfoot>
				<tbody>
					<tr ng-repeat="proc in procedimientosfiltrados |filter:filtrotxtprocedimiento | orderBy : orderby : reverse | pagination : currentPage*itemsPerPage | limitTo: itemsPerPage">
						<td class="text-center"><span class="sparkline ng-cloak" data-value="{{proc.periodos[anualidad].solicitados | json}}"></span></td>
						<th class="text-center">{{proc.codigo}}</th>
						<td><a href="/procedimiento/{{proc.codigo}}">{{proc.denominacion}}</a></td>
						<td class="text-center">{{proc.cod_plaza}}</td>
						<td class="text-center"><a href="/actividad/{{proc.ancestros[ 0 ].id}}">{{proc.ancestros.length==0 ? '' : proc.ancestros[ 0 ].nombrelargo}}</a></td>
						<td class="text-right">{{proc.periodos[anualidad].totalsolicitudes}}</td>
						<td class="text-right">{{proc.periodos[anualidad].solicitados[mesanterior]}}</td>
					</tr>
				</tbody>
			</table>

			<div class="col-md-12 text-center" ng-If="pageCount()>0">
				<div class="pagination-div">
				 <ul class="pagination">
				  <li ng-class="DisablePrevPage()">
					  <span  ng-click="prevPage()">Anteriores</span>
				  </li>
				  <li ng-repeat="n in range()" ng-class="{active: n == currentPage}" ng-click="setPage(n)">
					  <span >{{n+1}}</span>
				  </li>
				  <li ng-class="DisableNextPage()">
					  <span ng-click="nextPage()">Siguientes</span>
				  </li>
				 </ul>
				</div>
			</div>
		</div>
	</div>
</div>

