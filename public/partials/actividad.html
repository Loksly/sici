
<div ng-controller="ActividadCtrl" class="row">
	<div ng-class="{'col-lg-4': !oculto, 'hidden': oculto}" class="left animated">
		<div class="panel panel-danger">
			<div class="panel-heading">
				<h3 class="panel-title">
					Organismos
				</h3>
			</div>
			<div class="panel-body">			
				<input type="text" ng-model="texto.$" placeholder="Filtro" style="margin-bottom:1em" class="form-control"/>
				<ul ng-if="arbol.length" style="padding-left:0.6em">
					<li ng-repeat="element in arbol |filter:texto| filter:filtrojerarquia	">
						<strong>
							[{{element.id}}] &nbsp;
						</strong>
						<span ng-class="{'bg-danger':element.id==seleccionado.id }" ng-click="setSeleccionado(element)" class="cursor"  title="Engloba {{element.numprocedimientos}} procedimientos">
							{{element.title}} 
						</span>
						<ul ng-if="element.nodes">
							<li ng-repeat="elemen in element.nodes |filter:texto | filter:filtrojerarquia">
								<strong>
									[{{elemen.id}}] &nbsp;
								</strong>
								<span ng-class="{'bg-danger':elemen.id==seleccionado.id }" ng-click="setSeleccionado(elemen)" class="cursor" title="Engloba {{elemen.numprocedimientos}} procedimientos">
									{{elemen.title}} 
								</span>
								<ul ng-if="elemen.nodes">
									<li ng-repeat="eleme in elemen.nodes |filter:texto |filter:filtrojerarquia">
										<strong>
											[{{eleme.id}}] &nbsp;
										</strong>
										<span ng-class="{'bg-danger':eleme.id==seleccionado.id }" ng-click="setSeleccionado(eleme)" class="cursor" title="Engloba {{eleme.numprocedimientos}} procedimientos">
											{{eleme.title}} 
										</span>

										<ul ng-if="eleme.nodes">
											<li ng-repeat="elem in eleme.nodes |filter:texto |filter:filtrojerarquia">
												<strong>
													[{{elem.id}}] &nbsp;
												</strong>
												<span ng-class="{'bg-danger':elem.id==seleccionado.id }" ng-click="setSeleccionado(elem)" class="cursor"  title="Engloba {{elem.numprocedimientos}} procedimientos">
													{{elem.title}} 
												</span>
											</li>
										</ul>

									</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div ng-class="{'col-lg-8': !oculto, 'col-lg-12': oculto}" class="right animated">
		<div ng-click="oculto=!oculto">
			<span class="glyphicon glyphicon-fullscreen pull-right">
			</span>
			<h2>
				{{seleccionado.title}}
			</h2>
		</div>
		<div ng-if="procedimientos.length" class="panel panel-danger">
			<div ng-click="filtrosocultos=!filtrosocultos" class="panel-heading">
				<span ng-class="{&quot;glyphicon-collapse-down&quot;:!filtrosocultos,&quot;glyphicon-expand&quot;:filtrosocultos}" class="glyphicon pull-right">
				</span>
				<div class="progress">
					<div role="progressbar" aria-valuenow="{{100*cumplimentados / count}}" aria-valuemin="0" aria-valuemax="100" style="width:{{100*cumplimentados / count}}%" class="progress-bar progress-bar-striped progress-bar-danger">
						{{(100*cumplimentados / count).toFixed(2)}}% ({{cumplimentados}} / {{count}})
					</div>
				</div>
			</div>
			<div ng-class="{'hidden': filtrosocultos}" class="panel-body">
				<form class="form-horizontal">
					<div ng-repeat="key in camposfiltros" class="form-group">
						<label class="control-label col-md-3">
							{{key| translate}}:
						</label>
						<div class="col-md-9">
							<select ng-model="filtro[key]" ng-options="fa.value as fa.name for (ky,fa) in filtros[key]" class="form-control">
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-md-3">Filtro:</label>
						<div class="col-md-9">
							<input ng-model="filtrotxtprocedimiento.$" class="form-control"/>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div>
			{{filtrotxtprocedimiento.codigo}}
		</div>
		<div ng-if="procedimientosfiltrados.length">
			<div class="cursor">
				<span ng-class="{&quot;glyphicon-collapse-down&quot;:!procedimientosocultos,&quot;glyphicon-expand&quot;:procedimientosocultos}" class="glyphicon pull-right">
				</span>
				<h3 ng-if="procedimientosfiltrados">
					<span class="badge">
						{{procedimientosfiltrados.length}}
					</span>
					<span>
						Procedimiento{{procedimientosfiltrados.length>
						1 ? 's' : ''}}
					</span>
				</h3>
			</div>
			<ul style="list-style:none">
				<li ng-repeat="proc in procedimientosfiltrados |filter:filtrotxtprocedimiento" ng-click="setProcedimiento(proc)" class="cursor">
					<span class="sparkline">
						{{proc.periodos[anualidad].solicitados | json}}
					</span>
					<strong>
						&nbsp;[{{proc.codigo}}]&nbsp;
					</strong>
					<a ng-class="{'bg-danger':proc.codigo==procedimientoSeleccionado.codigo }" href="/procedimiento/{{proc.codigo}}">
						{{proc.denominacion}}
					</a>
				</li>
			</ul>
		</div>
	</div>
</div>

