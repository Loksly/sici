
<div ng-controller="NewProcedimientoCtrl" class="row">
	<div ng-class="{'col-lg-12': !seleccionado, 'col-lg-5': !!seleccionado}" class="left animated">
		<div class="panel panel-danger">
			<div class="panel-heading">
				<h3 class="panel-title">
					Organismos
				</h3>
			</div>
			<div class="panel-body">			
				<input type="text" ng-model="texto.$" placeholder="Filtro" style="margin-bottom:1em" class="form-control"/>
				<ul ng-if="arbol.length" style="padding-left:0.6em">
					<li ng-repeat="element in arbol |filter:texto| filter:filtrojerarquia" ng-class="{'list-group-item-warning':element.id==seleccionado.id}">
						<p>
						<strong>
							[{{element.id}}] &nbsp;
						</strong>
						<span ng-click="setSeleccionado(element)" class="cursor"  title="Engloba {{element.numprocedimientos}} procedimientos">
							{{element.title}} 
						</span>
						<span class="badge pull-right">{{element.numprocedimientos}}</span>
						</p>
						<ul class="list-group" ng-if="element.nodes" style="clear:both">
							<li class="list-group-item" ng-repeat="elemen in element.nodes |filter:texto | filter:filtrojerarquia" ng-class="{'list-group-item-danger':elemen.id==seleccionado.id}">
							<p>
								<strong>
									[{{elemen.id}}] &nbsp;
								</strong>
								<span ng-click="setSeleccionado(elemen)" class="cursor" title="Engloba {{elemen.numprocedimientos}} procedimientos">
									{{elemen.title}} 
								</span>
								<span class="badge pull-right">{{elemen.numprocedimientos}}</span>
								</p>
								<ul ng-if="elemen.nodes" style="clear:both">
									<li ng-repeat="eleme in elemen.nodes |filter:texto |filter:filtrojerarquia"  ng-class="{'list-group-item-danger':eleme.id==seleccionado.id}" >
									<p>
										<strong>
											[{{eleme.id}}] &nbsp;
										</strong>
										<span ng-class="{'bg-danger':eleme.id==seleccionado.id }" ng-click="setSeleccionado(eleme)" class="cursor" title="Engloba {{eleme.numprocedimientos}} procedimientos">
											{{eleme.title}} 
										</span>
										<span class="badge pull-right">{{eleme.numprocedimientos}}</span>
										</p>
										<ul ng-if="eleme.nodes" style="clear:both">
											<li ng-repeat="elem in eleme.nodes |filter:texto |filter:filtrojerarquia">
											<p>
												<strong>
													[{{elem.id}}] &nbsp;
												</strong>
												<span ng-class="{'bg-danger':elem.id==seleccionado.id }" ng-click="setSeleccionado(elem)" class="cursor"  title="Engloba {{elem.numprocedimientos}} procedimientos">
													{{elem.title}} 
												</span>
												<span class="badge pull-right">{{elem.numprocedimientos}}</span>
												</p>
											</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div ng-class="{'col-lg-7': !!seleccionado, 'hidden': !seleccionado}" class="right animated" id="detallesjerarquia">
		<div ng-click="oculto=!oculto">
			<span class="glyphicon glyphicon-fullscreen pull-right">
			</span>
			<h2>
				{{seleccionado.title}}
			</h2>
		</div>
		
		<div class="panel panel-danger">
			<div class="panel-heading">
				<h3 class="panel-title">{{accion}} procedimiento</h3>
			</div>
			<div class="panel-body">
				<div class="btn-group">					
				</div>
				<label name="nombre" style="width:100%">
					<span>Denominaci&oacute;n: </span><input  class="form-control" type="text" ng-model="nombre" name="nombre" /> 					
				</label>
				<br/>
				<label name="codigo" style="width:100%">
					<span>C&oacute;digo: </span><input  class="form-control" type="text" ng-model="codigo" name="codigo" /> 
				</label>
				<br/>
				<label name="responsable" style="width:100%"> 
					<span>Responsable: </span><input  class="form-control" placeholder="Plaza o nombre o login carm"  type="text" typeahead="showPersona(eresp) for eresp in getPersonas($viewValue)" ng-model="responsable" name="responsable" /> 
				</label>
				<label name="padre" style="width:100%">
					<span>Procedimiento padre: </span>
					<input  placeholder="Introduce cualquier parte del c&oacute;digo o denominaci&oacute;n" class="form-control" type="text" ng-model="padre" name="padre" typeahead="procpadre.denominacion for procpadre in oallprocedimientos  | filter:{denominacion:$viewValue} | limitTo:10" /> 
				</label>
			</div>
		</div>
			<table class="table table-striped table-bordered table-condensed table-hover" id="procedimientostable">
				<thead>
					<tr>
						<th>Progreso</th>
						<th ng-class="{danger:orderby=='codigo' }" ng-click="reverse=!reverse;orderby='codigo'">{{'codigo'|translate}}</th>
						<th ng-class="{danger:orderby=='denominacion' }" ng-click="reverse=!reverse;orderby='denominacion'">{{'denominacion'|translate}}</th>
						<th ng-class="{danger:orderby=='cod_plaza' }" ng-click="reverse=!reverse;orderby='cod_plaza'">{{'cod_plaza'|translate}}</th>
						<th ng-class="{danger:orderby=='ancestro' }" ng-click="reverse=!reverse;orderby='ancestro'">{{'A cargo de'|translate}}</th>
						<th ng-class="{danger:orderby=='periodos[anualidad].totalsolicitudes' }" ng-click="reverse=!reverse;orderby='periodos[anualidad].totalsolicitudes'">Solicitudes {{anualidad}}</th>
						<th ng-class="{danger:orderby=='periodos[anualidad].solicitados[mesanterior]' }" ng-click="reverse=!reverse;orderby='periodos[anualidad].solicitados[mesanterior]'">Solicitudes {{meses[mesanterior]}}</th>
					</tr>
				</thead>
				<tfoot>
					<tr>
						<td colspan="7">
							<strong>NÂº de procedimientos listados:</strong>
							{{procedimientosfiltrados.length}}
							<span ng-click="$root.exportXLS('procedimientostable','procedimientos')" class="pull-right glyphicon glyphicon-floppy-disk"></span>
						</td>
					</tr>
				</tfoot>
				<tbody>
					<tr ng-repeat="proc in procedimientosfiltrados |filter:filtrotxtprocedimiento | orderBy : orderby : reverse">
						<td class="text-center"><span class="sparkline">{{proc.periodos[anualidad].solicitados | json}}</span></td>
						<th class="text-center">{{proc.codigo}}</th>
						<td><a href="/procedimiento/{{proc.codigo}}">{{proc.denominacion}}</a></td>
						<td class="text-center">{{proc.cod_plaza}}</td>
						<td class="text-center"><a href="/actividad/{{proc.ancestros[ 0 ].id}}">{{proc.ancestros.length==0 ? '' : proc.ancestros[ 0 ].nombrelargo}}</a></td>
						<td class="text-right">{{proc.periodos[anualidad].totalsolicitudes}}</td>
						<td class="text-right">{{proc.periodos[anualidad].solicitados[mesanterior]}}</td>
					</tr>
				</tbody>
			</table>

		</div>
	</div>
</div>

